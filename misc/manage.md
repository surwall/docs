# Windows管理

## 网络问题排查
ping不通可能是**防火墙**问题
1. 先ping回环地址 127.0.0.1    -->  检查本机通信
2. 再ping本网段其他主机       --> 检查内网通信
3. 再ping默认网关                --> 检查出口路由
4. 再ping其他网段的其他主机     --> 检查远程连通性
5. 测试域名解析  nslookup www.baidu.com

## 配置ip地址、网关

> 打开网络适配器 `Win+R` -> `ncpa.cpl` 

### 自动获取ip地址
* ip不固定，一般用于员工电脑
* 不易产生ip地址冲突，规划和调整方便
> 如无法获得地址，则采用临时地址`169.254.0.0/16`

### 手动指定ip地址
* ip固定，一般用于服务器


## 快捷操作
1. 彻底删除
	1. `del`直接删除，默认移动到回收站 按`Ctrl+z`恢复
	2. 按`shift+del`删除，永久删除
2. 放大缩小文件夹
	1. 按住shitft加滚轮调整文件夹大小


### word操作
#### 放大字体
选中`ctrl+shift+>` 放大 `ctrl+shift+<`缩小字体


### windows操作
1. 显示桌面 `Win+D`
2. 显示投影`Win+P`
3. 切换桌面 `Ctrl+Win+方向键`
4. 锁屏 `Win+L`
5. 设置 `Win+I`
6. 关闭当前窗口 `Alt+F4`
7. 资源管理器 `Win+E`
8. 任务管理器 `Ctrl+Shift+Esc`

### 运行 win+r
1. ncpa.cpl   网络连接
2. mspaint 画图
3. calc 计算器
4. winver windows版本信息
5. mstsc 远程桌面连接
6. shutdown -s -t 0 立即关机

## cmd
```cmd
nslookup qq.com  ;查看对应的ip地址
hostname ;主机名字


```

## 激活
```cmd
;是否激活
slmgr /xpr
```

## 远程管理
### rdp 远程访问
搜索 -- `mstsc` -- 对方ip地址

![](assets/Pasted%20image%2020221223130453.png)
* 远程设备挂载
![](assets/Pasted%20image%2020221223143441.png)

### 匿名访问
服务器创建anonymous或ftp用户，空密码
客户端不需要用户和密码

> ftp://marcus:123456@192.168.80.10


## 磁盘阵列 raid
| 种类 | 特点 | 使用场景 |
| ------|-------| --------------|
| RAID0| 快，不容错，>=2块 |  |
| RAID1| 冗余，利用率50%，=2块| 服务器系统盘 |
| RAID10| 快且冗余，容错，利用率50%，`2*n`块(n>=2) |  |
| RAID5 | 均衡，利用率(n-1)/n, >=3块 |  服务器数据 |
| RAID6 | 均衡，利用率(n-2)/n, >=4块| |
比如服务器有8块硬盘，2块用作系统盘raid1，安全，6块硬盘用RAID5，节省空间，还有一块用作热备(hot spare)，自动补上。


## 杀毒
ESET Nod32 企业杀毒软件

## 用户和权限
一个windows用户对应一个SID，系统根据sid区分用户，相应的权限等。所以用户名可以改，sid不能改。

> whoami /user

### 内置用户
windows内置用户不能删除。
* Administrator：权限最大 ，建议改名 lusrmgr.msc 里面找到用户改名 或者使用**计算机管理**
* Guest: 权限最小

> 一般Administrator需要改名，防止黑客攻击。
> ![](assets/Pasted%20image%2020230224203718.png)

### 用户管理操作
内置账号的权限太大或者太小，所以要设置单独账号给员工使用。
![](assets/Pasted%20image%2020230226130921.png)


禁用：离职的时候用
改名：新老员工交接
修改密码：用户自己修改需要密码，管理员可以直接修改员工密码

![](assets/Pasted%20image%2020221223151814.png)

>  不小心禁用了管理员账号怎么办？
>  1. 进入安全模式
>  2. 在cmd输入 `net user ntd /active:yes`默认是administrator，激活管理账号

### 本地安全策略设置
管理计算机资源。
#### 密码策略
* 密码必须符合复杂性要求，大写字母、小写字母、数字、符号其中三种类型，不能包含账号名
* 密码长度最小值：7
* 密码最长使用期限：默认42天
* 强制密码历史： （5）

> 测试密码爆破时间 [网址](https://www.security.org/how-secure-is-my-password/)

#### 锁定策略
账号锁定阈值：（3）允许输错的次数，需要管理员解锁
账户锁定时间：默认(30分钟)

#### 交互登录
* 不用每次按ctrl+alt+del，关闭该选项
![](assets/Pasted%20image%2020230226141349.png)


### 组账户
一般是为组授予权限，所有成员自动获得权限类似于RBAC(Role Based Access Control)。
常见的内置组：
1. Administrators 管理员组
2. Guests 来宾组
3. Remote Desktop Users 远程桌面服务
4. Users 普通用户组 （默认都是Users）
5. EveryOne 每个人都属于这个组
6. Network Configuration 设置网络的权限

用户添加到某个组
![](assets/Pasted%20image%2020230226143913.png)



## 文件夹的ntfs权限
* 完全控制：可执行所有操作
* 修改： 可修改、删除
* 读取和执行：可读取和执行，列出文件内容
* 可读取
* 写入：可创建文件夹或者文件
* 特殊权限：除了上述权限的其他权限就是特殊权限，更精细控制。

1. 首先禁用继承，修改子文件的权限

![](assets/Pasted%20image%2020230226155318.png)
2. 添加对应组或者用户，设置权限
![](assets/Pasted%20image%2020230226155442.png)

设置ntfs案例
创建文件夹并设置权限：
* 文件夹：财务部资料
	权限：财务部组（修改），administrators（完全控制）
* 文件夹：市场部资料
	权限：财务部组（读取和执行）,市场部（修改），administrators（完全控制）


### ntfs高级权限
权限累加：当用户属于多个组时，为不同组设权限时，用户最终权限产生权限的累加，拒绝权限优先。
> 文件的权限有限于文件夹的权限

ALP 规则就是把用户Account加入到组Local Group，为组设置权限Permission，提高效率。

权限继承：新建文件或文件夹，默认会继承上层的权限。下层可以拒绝继承，上层可以使下层继承（比如下层的权限乱了，可以同一重置所有下层的权限，初始化）。
![](assets/Pasted%20image%2020230226173049.png)

所有权：用户创建的文件，那个用户就具有所有权，就可以分权限。administrator可以夺取所有权。
![](assets/Pasted%20image%2020230226175354.png)


## 网络共享
1. 使用UNC快速访问路径。
> unc path，windows专用路径，访问局域网资源。`\\marcus-laptop\share`格式

2. 挂载为网络磁盘
`net use x: \\192.168.10.10\share`

> 访问ntfs共享文件夹时的有效权限，本地访问，不受共享权限控制，网络访问时，取共享权限、NTFS权限的最严值。如果是exfat(任何用户可读取）等，只会有网络权限。

![](assets/Pasted%20image%2020230226190630.png)

### 查看所有已共享文件夹
![](assets/Pasted%20image%2020230226191339.png)

### 创建隐藏共享文件夹
使用高级共享挂载名设置为$结尾，并设置对应权限。


## 磁盘管理
* 基本磁盘：传统磁盘管理方式，是系统默认的应用模式，只能管理本磁盘分区

* 动态磁盘：可以实现卷的大小动态调整、磁盘高可用、高可靠等特点

### 简单卷
简单卷可以压缩，扩展，扩展只能右边往左合并，使用Disk genius可以从右往左合并。

## 动态磁盘
动态磁盘用来灵活创建磁盘，但是只能是windows系统读取。

| 特性 | 简单卷 | 跨区卷 | 带区卷0 | 镜像卷1 | RAID5|
| -- | -- | -- | -- | -- | -- |
| 磁盘数 | 1 | >=2 | >=2 | 2 | >=3 |
| 利用率 | 100% | 100% | 100% | 50% | (n-1)/n |
| 容错 | 否 | 否 | 否 | 是 | 是 |
| IO性能 | 低 | 低 | 高 | 低 | 较高 |
| 可扩展 | 可 | 可 | 不可 | 不可 | 不可 |

跨区卷存储信息的顺序是存满第一块磁盘后逐渐向后面的磁盘存储。

* 硬RAID
	* 有RAID阵列卡管理，效率高
	* 主板 -> 阵列本 -> 硬盘 -> 操作系统 -> 数据
* 软RAID
	* 由操作系统管理，成本低
	* 主板-> 磁盘 -> 操作系统 -> RAID软件 -> 数据



## 数据备份
windows server backup是系统自带的备份和还原工具。
使用任务计划程序修改为每周备份一次。
![](assets/Pasted%20image%2020230227160728.png)


## PE系统
PE系统是微软开发的精简windows系统，用于救急。

## 超融合技术
多个主机合并成一个主机运行虚拟机，稳定。

> vmware调整引导顺序
![](assets/Pasted%20image%2020230227174917.png)

### 破解windows密码
1. 用U深度光盘引导电脑
2. windows密码保存在 `c:\windows\system32\config\SAM`
开始 -- 密码破解 -- NTPWEdit
3. 调整磁盘分区 DiskGenius

### 备份
备份分区(win文件)
![](assets/Pasted%20image%2020230227182251.png)
还原分区
![](assets/Pasted%20image%2020230227184655.png)

### 误删除恢复
使用Recuva、Disk Genius恢复
![](assets/Pasted%20image%2020230227191406.png)


## 故障恢复
### 硬件故障
服务器一般用8-10年左右，5年的残值不多了。
没有内存、不能启动
点亮基本条件：cpu、内存、显卡、主板、电源、显示器(没有硬盘也能点亮)
如何找到故障硬件：
用好的硬件替换，或者替换到其他机器上测试  

### 软件故障

## 常见故障
电脑死机 cpu风扇坏了(电脑过热保护)，软件，病毒

进入安全模式
1. 通过“重启按钮”按住shift键
2. 开机时长按shift键盘 -- 安全模式



## bios与uefi
1. bios启动流程
	1. 首先bios会进行自检POST(power-on self-test)
	2. 会按设置的引导顺序，寻找第一个磁区中的mbr，也就是boot loader程序
	3. 然后由boot loader(通常是与操作系统一起的)寻找kernel，然后启动操作系统
		1. 这里boot loader(grub2)可以展示选单，然后跳转到其他boot loader,启动windows
2. uefi启动流程
	1. uefi会寻找esp32(通常是fat格式)分区，启动里面的uefi程序（通常使用c语言编写），然后由其启动系统
	2. uefI-> eSP分区 -> `\efi\Microsoft\boot\bootmgfw.efi`->`efi\Microsoft\Boot\BCD`->`C:\Windows\system32\winload.efi`->加载内核启动系统->加载启动服务

bios只支持mbr,uefi支持gpt分区和mbr分区。


## dns
通过搭建dns服务器，使用内部网站。
![](assets/Pasted%20image%2020230301013328.png)

windows上的hosts文件 `C:\windows\System32\drivers\etc\hosts`

![](assets/Pasted%20image%2020230301013919.png)


## 搭建IIS web服务器
为什么配置网站需要域名？
因为如果一个服务器配置了多个虚拟主机的话，可以通过绑定的域名来区分。

## 数据库管理 DBMS
### 安装sql server
需要设置system账号，权限大。
![](assets/Pasted%20image%2020230301144714.png)

### sql server权限
#### 服务器级别角色
sysadmin角色权限最大
dbcreator创建更改删除还原数据库
#### 数据库级别角色
db_owner拥有数据库中所有的权限


### sql server备份
1. 完整备份：备份整个数据库，部分事务日志（只存关键事务），数据库结构，是任何其他备份的基础
2. 差异备份：备份上一次完整备份之后所有更改的数据，只能恢复到备份点
3. 事务日志备份：主要是T-SQL语句，记录了数据库的改变 ，能恢复到故障点

一般周日完整，每天做差异，每小时做日志，（根据颗粒度调整），出现故障时，先进行事务日志备份。日志备份相当于sql语句备份，速度快。出现故障时，为什么进行日志备份，因为日志包含时间点，比如13:44出的故障，那么可以恢复到13:43:39秒对应的那条sql日志上，精准恢复。
![](assets/Pasted%20image%2020230302000140.png)

### 具体操作
1. 确保sql server代理(负责执行自动化任务)在开启状态（服务中设置自启）
2. 创建备份计划
	1. 创建子计划，设置备份日期时间
	2. 设置任务，备份类型
	3. 保存
3. sql server代理->作业-> 查看相关计划作业


## erp管理
OA 公自动化系统（请假、采购、报销审批、计划、日报）
ERP 企业资源计划系统（财务）
CRM 客户关系管理系统
www 企业网站
mail 企业邮箱

**主流erp系统介绍**  
* 国内
	* 用友、金蝶
* 国际
	* SAP、Oracle


## 域
域，是集中管理网络资源的方式
工作组(workgroup)，是分散管理网络资源的方式，windows默认是workgroup
域控制器DC（Domain Controller），保存域中资源记录(AD活动数据库)的服务器
活动目录（AD），以数据库方式存储域中资源（用户、电脑、账号）
子域、域树、域林

### 部署域
条件
1. 升级域控条件
	1. 本地管理员权限
	2. windows server版
	3. NTFS分区
	4. 足够空间

2. 安装DC
	1. 配置根域名(xxx.com)和dns服务器
3. 创建域用户
	1. 在域中所有计算机都能使用域用户登录
4. OU代表域中每个组织，可以分文件夹管理
5. 使用组策略配置每个用户和计算机的权限（比如禁止修改桌面等）




## 装机
1. 使用深度装机
2. 装机完毕后，使用onekey创建系统映像生成母盘
3. 母盘可以批量装机（因为机器配置都一样，适合批量装机）
4. 打开需要装机的机器，（虚拟机中加入同一个网络），物理机使用从网络启动（bios中选择从网络启动）
5. 使用奇东锐腾pxe全自动网克工具，选择镜像文件，批量发送。
![](assets/Pasted%20image%2020230304211810.png)

### pxe网络批量装机条件
1. 主机数量多
2. 硬件相同或彼此兼容
3. 系统相同及应用软件

## 上网行为管理路由器
网关， 可以充当内网的网关。
控制和管理用户对互联网的使用，对网页过滤、网络应用的控制、带宽流量、信息收发审计、用户行为分析。

![](assets/ikuai-第%202%20页.drawio%201.png)


## bios杂谈
windows默认开启从bios里面获取时间，bios时间存储在cmos中，如果主板电池供电不足，会导致windows时间不准。
![](assets/Pasted%20image%2020230305103310.png)

通常管理员会给bios设置密码，防止用户修改时间，引导顺序等。
![](assets/Pasted%20image%2020230305103114.png)



## 常用命令
1. telnet 远程管理
2. mstsc 远程桌面
3. lusrmgr.msc 打开本地用户和组
4. diskmgmt.msc 磁盘管理
5. gpedit.msc 本地组策略
6. gpupdate /force 强制刷新策略
